# Opportunity Model

Opportunities in Planhat represent a sales opportunity, whether it's selling to a new customer or more commonly a chance of expanding an existing account.

Opportunities are not the same as Licenses, but when an opportunity is closed won in Planhat, there is an optional setting to generate a license based on the opportunity data.

## Model Fields

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| _id |  | objectId | Planhat identifier |
| salesStage |  | string | Sales stage of opportunity |
| companyId | Yes | objectId | Related company id (planhat identifier) |
| companyName |  | string | Company name. (Autogenerated) |
| dealDate |  | string | Deal date in ISO format |
| landingDate |  | string | Landing date of the opportunity in ISO format |
| closeDate |  | string | Close date of the opportunity in ISO format |
| externalId |  | string | The project id in your own system |
| sourceId |  | string | The opportunity id from an integration (Salesforce, Hubspot, etc) |
| _currency |  | string | The currency code, for example "USD" |
| title |  | string | Title of sales opportunity |
| ownerId |  | objectId | ObjectId of the team member owner of the opportunity |
| mrr |  | number | Monthly opportunity value |
| arr |  | number | Annual opportunity value |
| nrr |  | number | Non recurrent value |
| contractLength |  | integer | Contract Length (months, defaults to 12) |
| status |  | string | Status of the opportunity, could be: active, won or lost |
| stageHistory |  | array | Array of objects containing the history of this opportunity. (Autogenerated) |
| custom |  | object | Custom object with your custom properties |

## GET Single Opportunity

Retrieve a specific opportunity by its ID.

### Endpoint Details
- **URL:** `GET /opportunities/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/opportunities/58499569e2914f5171fa7f9d' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
{
  "_id": "58499569e2914f5171fa7f9d",
  "status": "lost",
  "companyId": "56bccdf554d64d837d01be86",
  "stageHistory": [
    {
      "stage": "opportunity",
      "to": "2016-12-08T17:16:25.153Z"
    }
  ],
  "landingDate": "2018-11-29T11:57:06.444Z",
  "comments": [],
  "__v": 0,
  "custom": null,
  "companyName": "Toyota"
}
```

## GET Multiple Opportunities

Retrieve a list of opportunities with optional filtering and pagination.

### Endpoint Details
- **URL:** `GET /opportunities`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)
- **Max Results:** 2,000 opportunities per request

### Query Parameters
- `companyId` - Filter using company id
- `limit` - Limit the list length. Default: 100, Max: 2,000
- `offset` - Start the list on a specific integer index
- `sort` - Sort based on a specific property. Prefix the property with "-" to change the sort order
- `select` - Select specific properties. Multiple properties can be specified separating them by commas

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/opportunities?limit=2&offset=0&sort=-mrr&select=_id,title,status' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
[
  {
    "_id": "5ced0734861084738e27ff21",
    "status": "lost",
    "title": "P1 enabled!"
  },
  {
    "_id": "5804f2e90abc84bf13ac5cd7",
    "title": "Up sell Opportunity",
    "status": "won"
  }
]
```

## PUT Update Opportunity

Update an existing opportunity by passing the opportunity _id in the request URL as a parameter.

### Endpoint Details
- **URL:** `PUT /opportunities/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Example Request

```bash
curl --location --request PUT 'https://api.planhat.com/opportunities/6101e99b72c0e0884d5e9139' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}' \
--data-raw '{
  "status": "won",
  "salesStage": "Closed won"
}'
```

### Example Response

```json
{
  "_id": "6101e99b72c0e0884d5e9139",
  "status": "won",
  "salesStage": "Closed won",
  "dealDate": "2021-08-03T00:00:00.000Z",
  "ownerId": "60ccb1c5965cc9e0f3848075",
  "_currency": "USD",
  "companyId": "61006bc89a3e0b702ed8ea49",
  "title": "New opportunity",
  "mrr": 250,
  "nrr": 500,
  "companyName": "Leo company",
  "stageHistory": [],
  "landingDate": "2021-07-28T23:34:51.636Z",
  "__v": 0,
  "closeDate": "2021-07-28T23:36:59.294Z"
}
```