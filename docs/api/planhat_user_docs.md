# User Model

Users are all your team members that need access to Planhat. Users can be created in the app, using spreadsheet upload or over API.

If a user is flagged as inactive, they will not be able to login to Planhat and they will not get notifications, but they will be available for assigning accounts etc.

## Model Fields

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| _id |  | objectId | Planhat identifier |
| email | Yes | string | Email of the user |
| nickName | Yes | string | Nickname of user which will be shown in Planhat |
| firstName | Yes | string | First name of user |
| lastName | Yes | string | Last name of user |
| roles |  | array | Array of role ids assigned to the user |
| externalId |  | string | The users' id in your system |
| inactive |  | boolean | Sets the user in inactive state. A user set as inactive won't be able to login and won't receive notifications. Default is true |
| image |  | object | Object containing the avatar information. (Autogenerated) |
| radarOneLine |  | boolean | Internal system field. (Autogenerated) |
| taskFilter |  | object | Object containing the task filter information. (Autogenerated) |
| companyFilter |  | string | Internal system field. (Autogenerated) |
| compressedView |  | boolean | Internal system field. (Autogenerated) |
| isHidden |  | boolean | Defines if the user is hidden within the system |
| notificationsEnabled |  | boolean | Defines if the user has notifications enabled. Default is true |
| createDate |  | string | ISO date of when the user was created. (Autogenerated) |
| createdAt |  | string | ISO date of when the user was created |
| updatedAt |  | string | ISO date of when the user was last updated. (Autogenerated) |
| permissions |  | array | Array of user's permissions. (Autogenerated) |
| tzOffset |  | number | User's timezone offset |
| managers |  | array | Array of user's manager(s) id(s) |
| teams |  | array | Array of user's team(s) id(s) |
| isExposedAsSenderOption |  | boolean | Sets user as option for email sender |
| custom |  | object | A flexible object with custom data |

## POST Create User

Create a new user.

### Endpoint Details
- **URL:** `POST /users`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Notes
- To create a user it's required to define in the payload a nickName, email, firstName, and lastName.

### Example Request

```bash
curl --location --request POST 'https://api.planhat.com/users' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}' \
--data-raw '{
  "email": "bob@test.com",
  "firstName": "Bob",
  "lastName": "Marley",
  "nickName": "Bob",
  "roles": [
    "57e2b92ff795575a5b8c4659"
  ]
}'
```

### Example Response

```json
{
  "skippedGettingStartedSteps": {
    "email": false,
    "linkedin": false,
    "avatar": false,
    "all": false,
    "team": false,
    "customers": false
  },
  "sharedNotificationsPrefs": {
    "enabled": [],
    "disabled": [],
    "disabledEvents": []
  },
  "image": {
    "path": ""
  },
  "firstName": "Bob",
  "lastName": "Marley",
  "isHidden": false,
  "removed": false,
  "inactive": true,
  "compressedView": false,
  "companyFilter": "",
  "taskFilter": "",
  "workflowFilter": "",
  "playLogDisabled": true,
  "radarOneLine": false,
  "expandedFolders": [],
  "usageReportColumnsEnabled": [],
  "companyUsersEnabledColumns": [],
  "revReportPeriodType": "past x days",
  "splitLayoutDisabled": false,
  "dailyDigest": true,
  "followerUpdate": true,
  "inAppNotifications": true,
  "lastVisitedCompanies": [],
  "lastVisitedEndusers": [],
  "roles": [
    "57e2b92ff795575a5b8c4659"
  ],
  "apiTokens": [],
  "poc": [],
  "isExposedAsSenderOption": false,
  "defaultMeetingLength": 60,
  "collapsedFolders": [],
  "type": "user",
  "_id": "61031e2ad414d49dcdb61b22",
  "email": "bob@test.com",
  "nickName": "Bob",
  "createDate": "2021-07-29T21:31:22.042Z",
  "__v": 0
}
```

## GET Single User

Retrieve a specific user by its ID.

### Endpoint Details
- **URL:** `GET /users/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Notes
- To get a specific user it's required to pass the _id in the request URL as a parameter.
- Alternately it's possible to get a user using its externalId adding a prefix.
- Example: `GET /users/extid-[externalId]`

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/users/564b063a508f068051ee82a5' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
{
  "_id": "564b063a508f068051ee82a5",
  "nickName": "Diego Checa",
  "email": "diego@planhat.com",
  "image": {
    "path": ""
  },
  "radarOneLine": false,
  "taskFilter": "",
  "compressedView": false,
  "isHidden": false,
  "createDate": "2016-02-11T18:07:49.173Z",
  "lastName": "",
  "firstName": "Diego",
  "__v": 13,
  "dailyDigest": true,
  "followerUpdate": true,
  "permissions": {
    "admin": true,
    "changeOwner": true,
    "onlyMyPortfolio": false,
    "developer": true
  },
  "revReportPeriodType": "past x days",
  "inAppNotifications": true,
  "playlistSection": "all",
  "lastDailyDigest": 18830,
  "accountAccess": "all accounts",
  "roles": [
    {
      "_id": "000000010000000000000000",
      "name": "CSM",
      "description": "Access to a few selected views and relevant accounts",
      "__v": 393
    },
    {
      "_id": "000000030000000000000000",
      "name": "Developer",
      "description": "Access to API keys, error pages etc",
      "__v": 4
    },
    {
      "_id": "000000000000000000000000",
      "name": "Administrator",
      "description": "Full access, including ability to edit users and settings",
      "__v": 55
    },
    {
      "_id": "000000020000000000000000",
      "name": "Manager",
      "description": "Access to the entire portfolio, and all functionality",
      "__v": 56
    }
  ],
  "inactive": false,
  "removed": false,
  "tzOffset": -5,
  "custom": {},
  "defaultMeetingLength": 60,
  "isExposedAsSenderOption": false,
  "splitLayoutDisabled": false,
  "type": "user"
}
```

## GET Multiple Users

Retrieve a list of users with optional filtering and pagination.

### Endpoint Details
- **URL:** `GET /users`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)
- **Max Results:** 10,000 users per request

### Query Parameters
- `limit` - Limit the list length. Default: 10,000, Max: 10,000
- `offset` - Start the list on a specific integer index
- `sort` - Sort based on a specific property. Prefix the property with "-" to change the sort order
- `select` - Select specific properties. Multiple properties can be specified separating them by commas

### Notes
- The GET /users endpoint will return the following fields by default: firstName, lastName, nickName, email, externalId, image, isHidden, removed, inactive, managers, teams, isExposedAsSenderOption, createdAt, updatedAt, and tzOffset.
- If required there is possible to select any other field(s) from the user using the select query param in the request.

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/users' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
[
  {
    "_id": "564b063a508f068051ee82a5",
    "nickName": "Diego Checa",
    "email": "diego@planhat.com",
    "image": {
      "path": ""
    },
    "radarOneLine": false,
    "taskFilter": "",
    "compressedView": false,
    "isHidden": false,
    "createDate": "2016-02-11T18:07:49.173Z",
    "lastName": "",
    "firstName": "Diego",
    "inactive": false,
    "removed": false,
    "tzOffset": -5,
    "custom": {},
    "defaultMeetingLength": 60,
    "isExposedAsSenderOption": false,
    "type": "user"
  },
  {
    "_id": "5524481f516d59216a6d2b80",
    "nickName": "Sarah",
    "email": "sarah@planhat.com",
    "image": {
      "spacesKey": "arrivato/team/5524481f516d59216a6d2b80_1527055421955.png",
      "path": ""
    },
    "radarOneLine": false,
    "taskFilter": "{\"owner\":\"5524481f516d59216a6d2b80\"}",
    "compressedView": false,
    "isHidden": false,
    "createDate": "2016-02-11T18:07:49.171Z",
    "lastName": "Jones",
    "firstName": "Sarah",
    "custom": {
      "Role": "CSM"
    },
    "inactive": false,
    "isExposedAsSenderOption": true,
    "removed": false,
    "tzOffset": 1,
    "defaultMeetingLength": 60,
    "type": "user"
  }
]
```

## PUT Update User

Update an existing user by passing the user _id in the request URL as a parameter.

### Endpoint Details
- **URL:** `PUT /users/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Notes
- To update a user it's required to pass the user _id in the request URL as a parameter.
- Alternately it's possible to update using the user externalId adding a prefix.
- Example: `PUT /users/extid-[externalId]`

### Example Request

```bash
curl --location --request PUT 'https://api.planhat.com/users/61031e2ad414d49dcdb61b22' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}' \
--data-raw '{
  "nickName": "Bob Marley"
}'
```

### Example Response

```json
{
  "_id": "61031e2ad414d49dcdb61b22",
  "skippedGettingStartedSteps": {
    "email": false,
    "linkedin": false,
    "avatar": false,
    "all": false,
    "team": false,
    "customers": false
  },
  "sharedNotificationsPrefs": {
    "enabled": [],
    "disabled": [],
    "disabledEvents": []
  },
  "image": {
    "path": ""
  },
  "firstName": "Bob",
  "lastName": "Marley",
  "isHidden": false,
  "removed": false,
  "inactive": true,
  "compressedView": false,
  "companyFilter": "",
  "taskFilter": "",
  "workflowFilter": "",
  "playLogDisabled": true,
  "radarOneLine": false,
  "roles": [
    "57e2b92ff795575a5b8c4659"
  ],
  "poc": [],
  "isExposedAsSenderOption": false,
  "defaultMeetingLength": 60,
  "collapsedFolders": [],
  "type": "user",
  "email": "bob@test.com",
  "nickName": "Bob Marley",
  "createDate": "2021-07-29T21:31:22.042Z",
  "__v": 0
}
```

## DELETE User

Delete a user by its ID.

### Endpoint Details
- **URL:** `DELETE /users/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Example Request

```bash
curl --location --request DELETE 'https://api.planhat.com/users/61031e2ad414d49dcdb61b22' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

## PUT Bulk Upsert Users

Create and/or update multiple users in a single request.

### Endpoint Details
- **URL:** `PUT /users`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)
- **Max Results:** 5,000 users per request

### Notes
- To create a user it's required to define a nickName, email, firstName, and lastName.
- To update a user it is required to specify in the payload one of the following keyables, listed in order of priority: _id, externalId, email.
- Since this is a bulk upsert operation it's possible to create and/or update multiple users with the same payload.

### Example Request

```bash
curl --location --request PUT 'https://api.planhat.com/users' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}' \
--data-raw '[
  {
    "email": "rob@test.com",
    "firstName": "Robbert",
    "lastName": "Rob",
    "nickName": "Tyler",
    "roles": [
      "57e2b92ff795575a5b8c4659"
    ]
  },
  {
    "email": "liz@test.com",
    "firstName": "Liz",
    "lastName": "Elizabeth",
    "nickName": "Gates",
    "roles": [
      "5d35c292344cb854c0a5af28"
    ]
  }
]'
```

### Example Response

```json
{
  "created": 2,
  "createdErrors": [],
  "insertsKeys": [
    {
      "_id": "61033193e41b0aa81c926c8b",
      "email": "rob@test.com"
    },
    {
      "_id": "61033193e41b0aa81c926c8c",
      "email": "liz@test.com"
    }
  ],
  "updated": 0,
  "updatedErrors": [],
  "updatesKeys": [],
  "nonupdates": 0,
  "modified": [],
  "upsertedIds": [
    "61033193e41b0aa81c926c8b",
    "61033193e41b0aa81c926c8c"
  ],
  "permissionErrors": []
}
```