# Conversation Model

Conversations can be of different types such as email, chat, support tickets, and manually logged notes. You can also create your own types in Planhat to represent things such as "in person meeting", "Training", etc. The default types (email, chat, ticket, call) are reserved and should not be created over API.

## Model Fields

| Property | Required | Type | Description |
|----------|----------|------|-------------|
| _id |  | objectId | Planhat identifier |
| subject |  | string | Title of the conversation |
| companyId | Yes | objectId | Related company id (planhat identifier) |
| companyName |  | string | Company name. (Autogenerated) |
| description |  | string | Description of the conversation |
| snippet |  | string | Formatted content of the conversation |
| date |  | string | ISO date when conversation was created |
| outDate |  | string | ISO date when conversation was sent |
| createDate |  | string | ISO date when conversation was created. (Autogenerated) |
| type |  | string | Type of conversation. Must reference a pre-existent conversation type in Planhat, or it will default to type: note |
| users |  | array | Array of user objects |
| endusers |  | array | Array of involved contacts (endusers ids). (Autogenerated) |
| externalId |  | string | The conversation id in your own system |
| activityTags |  | array | Array of strings to tag your notes |
| starred |  | boolean | Flag to mark a conversation as important or relevant |
| pinned |  | boolean | Pin a conversation at the top of the company and/or user profile |
| emailTemplateIds |  | array | Array of email template ids. (Autogenerated) |
| isOpen |  | boolean | Set a conversation or ticket as open or not, mostly related to CRM integrations. (Autogenerated) |
| tags |  | array | Array of strings to tag the conversation. (Autogenerated) |
| waitsToBeFiltered |  | boolean | Internal system field. (Autogenerated) |
| timeBucket |  | array | Internal system field. (Autogenerated) |
| archived |  | boolean | Mark a conversation as archived |
| numberOfParts |  | integer | Internal system field. (Autogenerated) |
| sender |  | array | Array of objects containing sender information. (Autogenerated) |
| history |  | array | Internal system field. (Autogenerated) |
| userIds |  | array | Array of user ids involved in the conversation. (Autogenerated) |
| hasMore |  | boolean | Internal system field. (Autogenerated) |
| isCustomType |  | boolean | Mark the conversation as custom type or not. (Autogenerated) |
| assigneeName |  | string | Internal system field. (Autogenerated) |
| numberOfRelevantParts |  | integer | Internal system field. (Autogenerated) |
| hasAttachments |  | boolean | Set to true if the conversation has attachments. (Autogenerated) |
| isSeen |  | boolean | Set to true to flag the conversation as seen. (Autogenerated) |
| custom |  | object | Custom object with your custom properties |

## GET Single Conversation

Retrieve a specific conversation by its ID.

### Endpoint Details
- **URL:** `GET /conversations/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/conversations/58e57392c9437d10624593fd' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
{
  "_id": "58e57392c9437d10624593fd",
  "type": "email",
  "numberOfParts": 1,
  "hasAttachments": false,
  "source": "bcc",
  "subject": "Test 6 on Oct 21 from BCC",
  "snippet": "Two new and one existing endusers! ",
  "days": 17095,
  "companyId": "56e911619f2ff04215515515",
  "timeBucket": [
    "2016",
    "2016-Q4",
    "2016-10",
    "2016-W43"
  ],
  "history": [],
  "tags": [],
  "isOpen": false,
  "users": [
    {
      "id": "57225af2dfb33aa3022e88e9",
      "name": "Vargha",
      "isOwner": true
    }
  ],
  "endusers": [
    {
      "id": "5b47a07ff1846fd087ede384",
      "name": "Max Payne"
    }
  ],
  "date": "2016-10-21T15:24:05.000Z",
  "__v": 0,
  "companyName": "Bonnier",
  "createDate": "2016-10-21T15:24:05.000Z",
  "outDate": "2016-10-21T15:24:05.000Z",
  "numberOfRelevantParts": 1,
  "custom": {
    "Test FF field to check @today cron job": false,
    "t1": 0,
    "HScore": 0,
    "Days in Phase": 0,
    "NRR30": 0,
    "t123": "undefined",
    "Logins": 0,
    "Renewal in days": -1,
    "Activity Count": 0,
    "Week No": 29.285714285714285
  },
  "userIds": [
    "57225af2dfb33aa3022e88e9"
  ],
  "hasMore": true,
  "isCustomType": false,
  "assigneeName": "",
  "isSeen": false,
  "starred": false,
  "pinned": false,
  "archived": false
}
```

## GET Multiple Conversations

Retrieve a list of conversations with optional filtering and pagination.

### Endpoint Details
- **URL:** `GET /conversations`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)
- **Max Results:** 2,000 conversations per request

### Query Parameters
- `companyId` - Filter using company id. Multiple ids can be used separating them by commas
- `limit` - Limit the list length. Default: 30, Max: 2,000
- `offset` - Start the list on a specific integer index
- `sort` - Sort based on a specific property. Prefix the property with "-" to change the sort order
- `select` - Select specific properties. Multiple properties can be specified separating them by commas

### Example Request

```bash
curl --location --request GET 'https://api.planhat.com/conversations?limit=2&offset=0' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}'
```

### Example Response

```json
[
  {
    "date": "2021-07-29T15:29:34.330Z",
    "userIds": [
      "58e231b14246fc73139f29e8"
    ],
    "hasMore": false,
    "isCustomType": false,
    "subject": "Chat with the client",
    "snippet": "Slack chat with the client.",
    "_id": "6102e3b08084189dcbf0e3f0",
    "type": "note",
    "tags": [],
    "createDate": "2021-07-29T17:21:52.347Z",
    "companyId": "61006bc89a3e0b702ed8ea49",
    "companyName": "Leo company",
    "users": [
      {
        "id": "58e231b14246fc73139f29e8",
        "name": "Alex",
        "isOwner": true
      }
    ],
    "endusers": [
      {
        "id": "610091916d643a7c418aef42",
        "name": "Lara Croft"
      }
    ],
    "assigneeName": "",
    "activityTags": [],
    "hasAttachments": false,
    "isSeen": false,
    "starred": false,
    "pinned": false,
    "archived": false
  },
  {
    "date": "2021-07-26T16:51:44.146Z",
    "userIds": [
      "5f16fd8eee876638a9f2483c"
    ],
    "isCustomType": false,
    "subject": "t6",
    "_id": "60fee824a4c764252c877c2b",
    "type": "note",
    "tags": [],
    "createDate": "2021-07-26T16:51:48.720Z",
    "companyId": "584d9d5505ba1b622f04adb3",
    "companyName": "Daimler North America",
    "users": [
      {
        "id": "5f16fd8eee876638a9f2483c",
        "name": "Ernesto",
        "isOwner": true
      }
    ],
    "endusers": [],
    "assigneeName": "",
    "activityTags": [],
    "hasAttachments": false,
    "isSeen": false,
    "starred": false,
    "pinned": false,
    "archived": false,
    "custom": {
      "Activity Count": 0,
      "Days in Phase": 0,
      "Logins": 0
    }
  }
]
```

## PUT Update Conversation

Update an existing conversation by passing the conversation _id in the request URL as a parameter.

### Endpoint Details
- **URL:** `PUT /conversations/{id}`
- **Authentication:** Bearer token required
- **Rate Limits:** 200 calls/minute (soft), 150 req/sec (hard)

### Example Request

```bash
curl --location --request PUT 'https://api.planhat.com/conversations/6102e3b08084189dcbf0e3f0' \
--header 'Content-Type: application/json' \
--header 'Authorization: Bearer {{apiToken}}' \
--data-raw '{
  "subject": "Chat with the client",
  "description": "<p>Slack chat with the client.</p>"
}'
```

### Example Response

```json
{
  "_id": "6102e3b08084189dcbf0e3f0",
  "starred": false,
  "pinned": false,
  "autoTags": [],
  "activityTags": [],
  "emailTemplateIds": [],
  "isOpen": false,
  "tags": [],
  "waitsToBeFiltered": true,
  "timeBucket": [],
  "archived": false,
  "users": [
    {
      "id": "58e231b14246fc73139f29e8",
      "name": "Alex",
      "isOwner": true
    }
  ],
  "date": "2021-07-29T15:29:34.330Z",
  "type": "note",
  "companyId": "61006bc89a3e0b702ed8ea49",
  "subject": "Chat with the client",
  "description": "Slack chat with the client.",
  "endusers": [
    {
      "id": "610091916d643a7c418aef42",
      "name": "Lara Croft"
    }
  ],
  "snippet": "Slack chat with the client.",
  "companyName": "Tenet",
  "createDate": "2021-07-29T17:21:52.347Z",
  "sender": [],
  "history": [],
  "__v": 0
}
```